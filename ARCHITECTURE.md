# ğŸ—ï¸ MediPlain - System Architecture

## High-Level Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER BROWSER                             â”‚
â”‚                   (http://localhost:5173)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–²
                            â”‚ (HTTP/REST)
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND - REACT 19.2                        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  App.jsx                                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Dashboard.jsx                                       â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ UploadReport.jsx (OCR)                         â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ ExplainReport.jsx (AI)                         â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ HealthSummary.jsx                              â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â”€ QRAccess.jsx (Emergency)                       â”‚  â”‚
â”‚  â”‚  â””â”€â”€ EmergencyView.jsx                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ State Mgmt     â”‚ Services     â”‚ Utils          â”‚             â”‚
â”‚  â”‚ (Zustand)     â”‚              â”‚                â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚useHealthStore  â”‚aiService.js  â”‚encryption.js   â”‚             â”‚
â”‚  â”‚useUIStore      â”‚firebaseServ. â”‚ocr.js          â”‚             â”‚
â”‚  â”‚                â”‚              â”‚qrCode.js       â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ External Libraries                                       â”‚  â”‚
â”‚  â”‚ â€¢ Tesseract.js (OCR)                                     â”‚  â”‚
â”‚  â”‚ â€¢ crypto-js (Encryption)                                 â”‚  â”‚
â”‚  â”‚ â€¢ qrcode (QR Generation)                                 â”‚  â”‚
â”‚  â”‚ â€¢ axios (HTTP)                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  Build Tool: Vite 7.2                                          â”‚
â”‚  Package Manager: npm                                          â”‚
â”‚  Router: React Router 7.13                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–²
                            â”‚ (HTTP/REST API)
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BACKEND      â”‚  â”‚   FIREBASE    â”‚  â”‚  AI/LLM SERVICEâ”‚
â”‚  NODE.JS/      â”‚  â”‚   SERVICES    â”‚  â”‚  (Optional)    â”‚
â”‚  EXPRESS       â”‚  â”‚               â”‚  â”‚                â”‚
â”‚  (port 3000)   â”‚  â”‚               â”‚  â”‚ Medical-tuned  â”‚
â”‚                â”‚  â”‚               â”‚  â”‚ Language Model â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚                â”‚
â”‚ â”‚ /api/ai/* â”‚ â”‚  â”‚ â”‚Firestore â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”‚ endpoints  â”‚ â”‚  â”‚ â”‚(Database)â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ CORS enabled   â”‚  â”‚ â”‚ Storage  â”‚  â”‚
â”‚ Error handling â”‚  â”‚ â”‚(Reports) â”‚  â”‚
â”‚ Request loggingâ”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                â”‚  â”‚ â”‚ Auth     â”‚  â”‚
â”‚                â”‚  â”‚ â”‚(Optional)â”‚  â”‚
â”‚                â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

### 1. Medical Report Upload & OCR

```
User Uploads Image
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UploadReport.jsxâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  processReportImage()    â”‚
â”‚  (utils/ocr.js)          â”‚
â”‚                          â”‚
â”‚ 1. Read file as ArrayBuf â”‚
â”‚ 2. Send to Tesseract     â”‚
â”‚ 3. Extract text          â”‚
â”‚ 4. Parse structure       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Extracted Text   â”‚
â”‚ Parsed Data      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º Save to Zustand Store
         â”œâ”€â–º Display in UI
         â””â”€â–º Optional: Upload to Firebase
```

### 2. AI Health Analysis

```
Extracted Report Text
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ExplainReport.jsx        â”‚
â”‚ Click "Analyze" button   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ explainMedicalReport()   â”‚
â”‚ (services/aiService.js)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ (HTTP POST)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend API              â”‚
â”‚ /api/ai/explain-report   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º Optional: Call LLM API
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response:        â”‚
â”‚ â€¢ explanation    â”‚
â”‚ â€¢ summary        â”‚
â”‚ â€¢ keyFindings    â”‚
â”‚ â€¢ recommendationsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Display in UI with Status Icons
(good/warning/info)
```

### 3. Emergency QR Generation

```
Generate QR Button Click
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QRAccess.jsx         â”‚
â”‚ Select expiration    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ generateEmergencyQR()    â”‚
â”‚ (utils/qrCode.js)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º createTimeBoundToken()
         â”‚   â””â”€â–º Add expiration time
         â”‚
         â”œâ”€â–º encryptData()
         â”‚   â””â”€â–º AES-256 encryption
         â”‚
         â””â”€â–º QRCode.toDataURL()
             â””â”€â–º Generate QR image
                 â”‚
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ QR Code DataURL    â”‚
         â”‚ (encrypted data)   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚          â”‚          â”‚
    Display    Download    Print
    in UI      as PNG      as PDF
```

### 4. Emergency Access (Scanning QR)

```
First Responder Scans QR
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QR Code Data             â”‚
â”‚ (encrypted token)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Decrypt Token            â”‚
â”‚ decryptData()            â”‚
â”‚ (encryption.js)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Verify Time Bound        â”‚
â”‚ verifyTimeBoundToken()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚          â”‚
  Valid?    Expired?
    â”‚          â”‚
    â–¼          â–¼
  Show      Access
  Health    Denied
  Data
```

---

## Database Schema (Firestore)

```
Firestore Structure:
â”œâ”€â”€ patients/
â”‚   â””â”€â”€ {patientId}/
â”‚       â”œâ”€â”€ name: "Aditi Shikha"
â”‚       â”œâ”€â”€ bloodGroup: "O+"
â”‚       â”œâ”€â”€ age: 28
â”‚       â”œâ”€â”€ allergies: ["Penicillin", "Peanuts"]
â”‚       â”œâ”€â”€ chronicConditions: ["Asthma"]
â”‚       â”œâ”€â”€ medications: ["Albuterol"]
â”‚       â”œâ”€â”€ encryptedData: <AES-256 encrypted>
â”‚       â”œâ”€â”€ updatedAt: Timestamp
â”‚       â”œâ”€â”€ createdAt: Timestamp
â”‚       â”‚
â”‚       â”œâ”€â”€ reports/
â”‚       â”‚   â””â”€â”€ {reportId}/
â”‚       â”‚       â”œâ”€â”€ fileName: "blood_test.jpg"
â”‚       â”‚       â”œâ”€â”€ uploadedAt: Timestamp
â”‚       â”‚       â”œâ”€â”€ fileSize: 2048576
â”‚       â”‚       â”œâ”€â”€ storagePath: "medical-reports/..."
â”‚       â”‚       â”œâ”€â”€ extractedText: "..."
â”‚       â”‚       â””â”€â”€ parsedData: {...}
â”‚       â”‚
â”‚       â”œâ”€â”€ emergencyAccess/
â”‚       â”‚   â””â”€â”€ {accessId}/
â”‚       â”‚       â”œâ”€â”€ token: <encrypted>
â”‚       â”‚       â”œâ”€â”€ expiresAt: Timestamp
â”‚       â”‚       â”œâ”€â”€ accessedAt: Timestamp
â”‚       â”‚       â””â”€â”€ encryptedData: <AES-256>
â”‚       â”‚
â”‚       â””â”€â”€ reminders/
â”‚           â””â”€â”€ {reminderId}/
â”‚               â”œâ”€â”€ medication: "Albuterol"
â”‚               â”œâ”€â”€ frequency: "twice daily"
â”‚               â”œâ”€â”€ time: "08:00"
â”‚               â”œâ”€â”€ status: "active"
â”‚               â””â”€â”€ createdAt: Timestamp

Cloud Storage Structure:
â”œâ”€â”€ medical-reports/
â”‚   â””â”€â”€ {patientId}/
â”‚       â””â”€â”€ {timestamp}_{filename}
â”‚           â””â”€â”€ (binary file data)
```

---

## Component Hierarchy

```
App
â”œâ”€â”€ Navbar
â””â”€â”€ Routes
    â”œâ”€â”€ Route: "/" â†’ Dashboard
    â”‚   â”œâ”€â”€ Grid Layout
    â”‚   â”œâ”€â”€ Column 1
    â”‚   â”‚   â”œâ”€â”€ UploadReport
    â”‚   â”‚   â”‚   â””â”€â”€ Uses: processReportImage()
    â”‚   â”‚   â””â”€â”€ ExplainReport
    â”‚   â”‚       â””â”€â”€ Uses: explainMedicalReport()
    â”‚   â””â”€â”€ Column 2
    â”‚       â”œâ”€â”€ HealthSummary
    â”‚       â”‚   â””â”€â”€ Edit patient data
    â”‚       â””â”€â”€ QRAccess
    â”‚           â””â”€â”€ Uses: generateEmergencyQR()
    â”‚
    â””â”€â”€ Route: "/emergency/:patientId" â†’ EmergencyView
        â””â”€â”€ Display emergency health summary

Modal (Reusable)
â”œâ”€â”€ Used by ExplainReport
â”œâ”€â”€ Shows detailed recommendations
â””â”€â”€ Displays extracted report text
```

---

## Security Architecture

```
Frontend Security:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Input â†’ Validation             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sensitive Data                      â”‚
â”‚ â”œâ”€ Encryption (crypto-js)          â”‚
â”‚ â”œâ”€ AES-256 cipher                  â”‚
â”‚ â””â”€ Key from environment variable   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Network Transport (HTTP â†’ HTTPS)    â”‚
â”‚ â”œâ”€ CORS configured                 â”‚
â”‚ â”œâ”€ Only frontend domain allowed    â”‚
â”‚ â””â”€ Credentials with requests       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend Validation                  â”‚
â”‚ â”œâ”€ CORS check                      â”‚
â”‚ â”œâ”€ Input sanitization              â”‚
â”‚ â””â”€ Error handling                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database Storage                    â”‚
â”‚ â”œâ”€ Data encrypted before storage   â”‚
â”‚ â”œâ”€ Firebase security rules         â”‚
â”‚ â””â”€ No credentials in code          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Time-Bound Access:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generate Token               â”‚
â”‚ â”œâ”€ Add expiration: +30 min  â”‚
â”‚ â”œâ”€ Encrypt with AES-256    â”‚
â”‚ â””â”€ Embed in QR code         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Share (Print/Download)       â”‚
â”‚ QR Code contains encrypted   â”‚
â”‚ time-bound data              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan & Verify                â”‚
â”‚ â”œâ”€ Decrypt token            â”‚
â”‚ â”œâ”€ Check expiration         â”‚
â”‚ â””â”€ Grant access or deny      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Encryption Flow

```
Plain Data
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ encryptData()                â”‚
â”‚ â”œâ”€ Convert to JSON string   â”‚
â”‚ â”œâ”€ Use AES cipher           â”‚
â”‚ â”œâ”€ Use ENCRYPTION_KEY       â”‚
â”‚ â””â”€ Return Base64 string     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Encrypted Data   â”‚
   â”‚ (safe to store)  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â”‚               â”‚
Store in         Send over
Firestore        Network
    â”‚               â”‚
    â–¼               â–¼
â”œâ”€ Database    â”œâ”€ API Request
â”œâ”€ Secure      â”œâ”€ HTTPS
â””â”€ Encrypted   â””â”€ Encrypted

Recovery Flow:
Encrypted Data
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ decryptData()                â”‚
â”‚ â”œâ”€ Take encrypted string    â”‚
â”‚ â”œâ”€ Use ENCRYPTION_KEY       â”‚
â”‚ â”œâ”€ Decrypt with AES         â”‚
â”‚ â”œâ”€ Parse JSON               â”‚
â”‚ â””â”€ Return plain object      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Plain Data       â”‚
    â”‚ (ready to use)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API Request/Response Cycle

```
Frontend (React)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ aiService.js                        â”‚
â”‚ explainMedicalReport({              â”‚
â”‚   text: "patient_report_text"       â”‚
â”‚ })                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        POST /api/ai/explain-report
               â”‚
               â–¼
Backend (Express)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ route: POST /api/ai/explain-report  â”‚
â”‚                                     â”‚
â”‚ 1. Receive request                 â”‚
â”‚ 2. Validate input                  â”‚
â”‚ 3. Process with AI/LLM             â”‚
â”‚ 4. Format response                 â”‚
â”‚ 5. Send JSON                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
         JSON Response
               â”‚
               â–¼
Frontend (React)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response Object:                    â”‚
â”‚ {                                   â”‚
â”‚   explanation: "...",               â”‚
â”‚   summary: "...",                   â”‚
â”‚   keyFindings: ["..."],             â”‚
â”‚   recommendations: ["..."],         â”‚
â”‚   warnings: []                      â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ExplainReport.jsx                   â”‚
â”‚ â”œâ”€ Update state                    â”‚
â”‚ â”œâ”€ Parse insights                  â”‚
â”‚ â””â”€ Render UI with data             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Management Flow (Zustand)

```
Component Mounts
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useHealthStore()       â”‚
â”‚ {                      â”‚
â”‚   patient: null,       â”‚
â”‚   reports: [],         â”‚
â”‚   reminders: [],       â”‚
â”‚   loading: false,      â”‚
â”‚   error: null          â”‚
â”‚ }                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            â”‚        â”‚         â”‚
    â–¼            â–¼        â–¼         â–¼
setPatient   addReport  addReminder setLoading
    â”‚            â”‚        â”‚         â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚
         â–¼            â–¼
    Update Store   Re-render
    (Immutable)    Components
         â”‚            â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    Components get fresh data
    (via hook subscriptions)
```

---

## OCR Processing Pipeline

```
Image File
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FileReader API           â”‚
â”‚ readAsArrayBuffer()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tesseract.recognize()    â”‚
â”‚ â”œâ”€ Download model (1st)  â”‚
â”‚ â”œâ”€ Load image            â”‚
â”‚ â”œâ”€ Run OCR               â”‚
â”‚ â”œâ”€ Extract text          â”‚
â”‚ â””â”€ Return confidence     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ parsemedicalReport()     â”‚
â”‚ â”œâ”€ Split by lines       â”‚
â”‚ â”œâ”€ Identify sections    â”‚
â”‚ â”œâ”€ Extract key-values   â”‚
â”‚ â””â”€ Structure data       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Parsed Report Object     â”‚
â”‚ {                        â”‚
â”‚   raw: "text",           â”‚
â”‚   sections: {...},       â”‚
â”‚   keyValues: {...}       â”‚
â”‚ }                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deployment Architecture (Future)

```
Production Deployment:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CDN / Static Hosting                   â”‚
â”‚  (Vercel, Netlify, or AWS S3 + CloudFront)        â”‚
â”‚                                                     â”‚
â”‚  Serves:                                            â”‚
â”‚  â”œâ”€â”€ React app (compiled to static files)          â”‚
â”‚  â”œâ”€â”€ JavaScript bundles                           â”‚
â”‚  â””â”€â”€ Static assets                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ (HTTPS)
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load Balancer / API Gateway    â”‚
â”‚  â”œâ”€ Rate limiting              â”‚
â”‚  â”œâ”€ Request validation         â”‚
â”‚  â””â”€ Routing                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend App    â”‚   â”‚  Caching Layer  â”‚
â”‚  (Node.js/Expr) â”‚   â”‚  (Redis)        â”‚
â”‚  â”œâ”€ Auto scale  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”œâ”€ Health chk  â”‚
â”‚  â””â”€ Log aggr    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                  â”‚             â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ Firestore  â”‚  â”‚Cr. Storage â”‚  â”‚Secrets  â”‚
â”‚  Database  â”‚  â”‚(Reports)   â”‚  â”‚Manager  â”‚
â”‚ â”œâ”€ Backup  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”œâ”€ Replica â”‚
â”‚ â””â”€ Monitor â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Monitoring:
â”œâ”€ Application logs
â”œâ”€ Error tracking
â”œâ”€ Performance monitoring
â”œâ”€ Uptime monitoring
â””â”€ Security alerts
```

---

## Summary

This architecture provides:
- âœ… **Scalability** - Stateless frontend & backend
- âœ… **Security** - Encryption at multiple layers
- âœ… **Reliability** - Error handling & fallbacks
- âœ… **Maintainability** - Modular component structure
- âœ… **Performance** - Optimized OCR & API calls
- âœ… **Flexibility** - Easy to integrate new services

The system is designed to grow from development to production with minimal changes!
